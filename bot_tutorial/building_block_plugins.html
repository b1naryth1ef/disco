
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Plugins Â· Disco</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="building_block_commands.html" />
    
    
    <link rel="prev" href="first_steps.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../installation.html">
            
                <a href="../installation.html">
            
                    
                    Installation and Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="intro.md">
            
                <span>
            
                    
                    Bot Tutorial
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="first_steps.html">
            
                <a href="first_steps.html">
            
                    
                    Creating and Running a Bot
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.2" data-path="building_block_plugins.html">
            
                <a href="building_block_plugins.html">
            
                    
                    Plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="building_block_commands.html">
            
                <a href="building_block_commands.html">
            
                    
                    Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="building_block_listeners.html">
            
                <a href="building_block_listeners.html">
            
                    
                    Listeners
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="message_embeds.html">
            
                <a href="message_embeds.html">
            
                    
                    Message Embeds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="advanced.html">
            
                <a href="advanced.html">
            
                    
                    Advanced
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    API Docs
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../api/disco_client.html">
            
                <a href="../api/disco_client.html">
            
                    
                    disco.client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../api/disco_state.html">
            
                <a href="../api/disco_state.html">
            
                    
                    disco.state
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../api/disco_cli.html">
            
                <a href="../api/disco_cli.html">
            
                    
                    disco.cli
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" >
            
                <span>
            
                    
                    Bot
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.4.1" data-path="../api/disco_bot_bot.html">
            
                <a href="../api/disco_bot_bot.html">
            
                    
                    disco.bot.bot
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.2" data-path="../api/disco_bot_plugin.html">
            
                <a href="../api/disco_bot_plugin.html">
            
                    
                    disco.bot.plugin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.3" data-path="../api/disco_bot_command.html">
            
                <a href="../api/disco_bot_command.html">
            
                    
                    disco.bot.command
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.4" data-path="../api/disco_bot_storage.html">
            
                <a href="../api/disco_bot_storage.html">
            
                    
                    disco.bot.storage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.5" data-path="../api/disco_bot_parser.html">
            
                <a href="../api/disco_bot_parser.html">
            
                    
                    disco.bot.parser
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.5" >
            
                <span>
            
                    
                    API
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="../api/disco_api_client.html">
            
                <a href="../api/disco_api_client.html">
            
                    
                    disco.api.client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.2" data-path="../api/disco_api_http.html">
            
                <a href="../api/disco_api_http.html">
            
                    
                    disco.api.http
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.3" data-path="../api/disco_api_ratelimit.html">
            
                <a href="../api/disco_api_ratelimit.html">
            
                    
                    disco.api.ratelimit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.6" >
            
                <span>
            
                    
                    Gateway
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.6.1" data-path="../api/disco_gateway_client.html">
            
                <a href="../api/disco_gateway_client.html">
            
                    
                    disco.gateway.client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.2" data-path="../api/disco_gateway_events.html">
            
                <a href="../api/disco_gateway_events.html">
            
                    
                    disco.gateway.events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.3" data-path="../api/disco_gateway_packets.html">
            
                <a href="../api/disco_gateway_packets.html">
            
                    
                    disco.gateway.packets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.4" data-path="../api/disco_gateway_sharder.html">
            
                <a href="../api/disco_gateway_sharder.html">
            
                    
                    disco.gateway.sharder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.5" data-path="../api/disco_gateway_ipc.html">
            
                <a href="../api/disco_gateway_ipc.html">
            
                    
                    disco.gateway.ipc
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.7" >
            
                <span>
            
                    
                    Types
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.1" data-path="../api/disco_types_base.html">
            
                <a href="../api/disco_types_base.html">
            
                    
                    disco.types.base
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.2" data-path="../api/disco_types_channel.html">
            
                <a href="../api/disco_types_channel.html">
            
                    
                    disco.types.channel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.3" data-path="../api/disco_types_guild.html">
            
                <a href="../api/disco_types_guild.html">
            
                    
                    disco.types.guild
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.4" data-path="../api/disco_types_invite.html">
            
                <a href="../api/disco_types_invite.html">
            
                    
                    disco.types.invite
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.5" data-path="../api/disco_types_message.html">
            
                <a href="../api/disco_types_message.html">
            
                    
                    disco.types.message
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.6" data-path="../api/disco_types_permissions.html">
            
                <a href="../api/disco_types_permissions.html">
            
                    
                    disco.types.permissions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.7" data-path="../api/disco_types_user.html">
            
                <a href="../api/disco_types_user.html">
            
                    
                    disco.types.user
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.8" data-path="../api/disco_types_voice.html">
            
                <a href="../api/disco_types_voice.html">
            
                    
                    disco.types.voice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.9" data-path="../api/disco_types_webhook.html">
            
                <a href="../api/disco_types_webhook.html">
            
                    
                    disco.types.webhook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.8" >
            
                <span>
            
                    
                    Util
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.8.1" data-path="../api/disco_util.html">
            
                <a href="../api/disco_util.html">
            
                    
                    disco.util
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2" data-path="../api/disco_util_backdoor.html">
            
                <a href="../api/disco_util_backdoor.html">
            
                    
                    disco.util.backdoor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.3" data-path="../api/disco_util_chains.html">
            
                <a href="../api/disco_util_chains.html">
            
                    
                    disco.util.chains
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.4" data-path="../api/disco_util_config.html">
            
                <a href="../api/disco_util_config.html">
            
                    
                    disco.util.config
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.5" data-path="../api/disco_util_functional.html">
            
                <a href="../api/disco_util_functional.html">
            
                    
                    disco.util.functional
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.6" data-path="../api/disco_util_hashmap.html">
            
                <a href="../api/disco_util_hashmap.html">
            
                    
                    disco.util.hashmap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.7" data-path="../api/disco_util_limiter.html">
            
                <a href="../api/disco_util_limiter.html">
            
                    
                    disco.util.limiter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.8" data-path="../api/disco_util_logging.html">
            
                <a href="../api/disco_util_logging.html">
            
                    
                    disco.util.logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.9" data-path="../api/disco_util_sanitize.html">
            
                <a href="../api/disco_util_sanitize.html">
            
                    
                    disco.util.sanitize
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.10" data-path="../api/disco_util_snowflake.html">
            
                <a href="../api/disco_util_snowflake.html">
            
                    
                    disco.util.snowflake
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.11" data-path="../api/disco_util_token.html">
            
                <a href="../api/disco_util_token.html">
            
                    
                    disco.util.token
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.12" data-path="../api/disco_util_websocket.html">
            
                <a href="../api/disco_util_websocket.html">
            
                    
                    disco.util.websocket
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.9" >
            
                <span>
            
                    
                    Voice
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.9.1" data-path="../api/disco_voice_client.html">
            
                <a href="../api/disco_voice_client.html">
            
                    
                    disco.voice.client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9.2" data-path="../api/disco_voice_opus.html">
            
                <a href="../api/disco_voice_opus.html">
            
                    
                    disco.voice.opus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9.3" data-path="../api/disco_voice_packets.html">
            
                <a href="../api/disco_voice_packets.html">
            
                    
                    disco.voice.packets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9.4" data-path="../api/disco_voice_playable.html">
            
                <a href="../api/disco_voice_playable.html">
            
                    
                    disco.voice.playable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9.5" data-path="../api/disco_voice_player.html">
            
                <a href="../api/disco_voice_player.html">
            
                    
                    disco.voice.player
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Plugins</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="plugins">Plugins</h1>
<p>Plugins are Disco are a core abstraction which attempt to encapsulate the functionality of your bot into contained modules. To boil it down, commands related to one another, or listeners that control the same functionality should be within the same Plugin. Although it&apos;s possible to call and pass data between Plugins, you should generally attempt to avoid it.</p>
<h2 id="plugin-lifecycle">Plugin Lifecycle</h2>
<h3 id="loading">Loading</h3>
<p>Plugins are loaded when the Bot is initially created, and when this happens the <code>Plugin.load</code> function is called. If the plugin is being reloaded, the call to this function will contain a dictionary of data returned by the previous <code>unload</code> call. Using this, you can pass data between loaded instances of your plugin to help aid in seamless reloads. Often plugins will require some level of configuration and setup before running, and this code can be inserted within an overridden version of the load function, as such:</p>
<pre class="language-"><code class="lang-python"><span class="token keyword">class</span> <span class="token class-name">ExamplePlugin</span><span class="token punctuation">(</span>Plugin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">load</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span>ExamplePlugin<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>load<span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
        setup_database<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>data <span class="token operator">=</span> ctx<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&apos;data&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>The load function of a plugin is guaranteed to only be called once for the instance, when reloading a new instance of the plugin will be created.</p>
<h3 id="unloading">Unloading</h3>
<p>Plugins are unloaded in multiple scenarios (shutdown, before a reload, or during an unload), and when this happens the <code>Plugin.unload</code> function is called. This function is passed one argument containing a dictionary, which (if the plugin wants) can be filled with information that a future iteration (in the case we&apos;re reloading) of the plugin can use to maintain state. Plugins may want to call or save data before being unloaded, and in this case they can override the unload function:</p>
<pre class="language-"><code class="lang-python"><span class="token keyword">class</span> <span class="token class-name">ExamplePlugin</span><span class="token punctuation">(</span>Plugin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">unload</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ctx<span class="token punctuation">[</span><span class="token string">&apos;data&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>data
        super<span class="token punctuation">(</span>ExamplePlugin<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>unload<span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
</code></pre>
<p>During the unload sequence all greenlets which the plugin owns (e.g. greenlets for command or listener callbacks, any spawned with <code>Plugin.spawn</code>) are terminated. In the case where command callbacks should continue execution past the unload point (e.g. in the case where a plugin reloads itself), you should pass <code>oob=True</code> to the <code>Plugin.command</code> decorator.</p>
<h2 id="configuration">Configuration</h2>
<p>Disco supports a framework for dynamically passing configuration to plugins. By default, configuration files live within the <code>config/</code> directory, and are named after the plugin, e.g. <code>ExamplePlugin</code> would be configured via <code>config/example.json</code>. Adding support for configuration within your plugin can be done via a decorator:</p>
<pre class="language-"><code class="lang-python"><span class="token keyword">from</span> disco<span class="token punctuation">.</span>bot <span class="token keyword">import</span> Plugin<span class="token punctuation">,</span> Config

<span class="token keyword">class</span> <span class="token class-name">ExamplePluginConfig</span><span class="token punctuation">(</span>Config<span class="token punctuation">)</span><span class="token punctuation">:</span>
    var1 <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span>
    var2 <span class="token operator">=</span> <span class="token boolean">True</span>


@Plugin<span class="token punctuation">.</span>with_config<span class="token punctuation">(</span>ExamplePluginConfig<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExamplePlugin</span><span class="token punctuation">(</span>Plugin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">load</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span>ExamplePlugin<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>load<span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
        <span class="token keyword">assert</span> self<span class="token punctuation">.</span>config<span class="token punctuation">.</span>var1 <span class="token operator">==</span> <span class="token string">&quot;test&quot;</span>
        <span class="token keyword">assert</span> self<span class="token punctuation">.</span>config<span class="token punctuation">.</span>var2
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="first_steps.html" class="navigation navigation-prev " aria-label="Previous page: Creating and Running a Bot">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="building_block_commands.html" class="navigation navigation-next " aria-label="Next page: Commands">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Plugins","level":"1.3.2","depth":2,"next":{"title":"Commands","level":"1.3.3","depth":2,"path":"bot_tutorial/building_block_commands.md","ref":"bot_tutorial/building_block_commands.md","articles":[]},"previous":{"title":"Creating and Running a Bot","level":"1.3.1","depth":2,"path":"bot_tutorial/first_steps.md","ref":"bot_tutorial/first_steps.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","hints"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"anchorjs":{"placement":"left","visible":"always"},"prism":{},"hints":{"danger":"fa fa-exclamation-circle","info":"fa fa-info-circle","tip":"fa fa-mortar-board","working":"fa fa-wrench"},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Disco","gitbook":"*"},"file":{"path":"bot_tutorial/building_block_plugins.md","mtime":"2017-10-16T17:12:36.640Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2018-02-15T05:53:11.657Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

